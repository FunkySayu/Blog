
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Example-of-user-environment-configuration">Example of user environment configuration<a class="anchor-link" href="#Example-of-user-environment-configuration">&#182;</a></h1><p>If you are a Linux user, you might sometime want to create your own executable (for example, a little bash script checking if your servers are alive, or a Python script checking the network usage...). Obviously, some of these scripts can not be installed globally on your system.</p>
<p>If you ask a student in my engineering school how to deal with it, about 90% of them will answer the following : <em>just put an alias in your <code>.whateverrc</code> like this :</em></p>
<div class="highlight"><pre><span class="nb">alias </span><span class="nv">mycommand</span><span class="o">=</span><span class="s1">&#39;/home/user/some/folders/myscript.sh&#39;</span>
</pre></div>
<p>Okay, it works. But when you have more than 10 scripts, more than only one shell, environment dependant scripts etc, it begins to be a bit hard to manage all your scripts with just aliases.</p>
<p>The overall idea of this post is to show you <strong>a way</strong> (not the only way) to manage your user environment, in order to simplify these kinds of things.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Unix-philosophy-:-make-your-life-easier">Unix philosophy : make your life easier<a class="anchor-link" href="#Unix-philosophy-:-make-your-life-easier">&#182;</a></h1><p>So just to explain, I use 2 different shells (<code>zsh</code> about everytime, and sometimes <code>bash</code> for really specific operations). I have something like 30 different scripts, 10 crons and stuff like that. Managing everything with aliases is just impossible. I had to find a cool setup, allowing me to simplify my life.</p>
<p>The point of my configuration is to purpose a setup for managing :</p>
<ul>
<li>global environment definition</li>
<li>shell dependant environment (like prompt, shell configuration...)</li>
<li>script startup without using alias</li>
<li>and some stuff like this...</li>
</ul>
<p>This setup depends of just few things and is pretty simple :</p>
<ul>
<li>use a <code>.profile</code> to manage your global environment seting</li>
<li>use your <code>.whateverrc</code> file to manage your shells</li>
<li>create a <code>bin/</code> directory containing all your scripts (or symbolic link to them)</li>
<li>and... that's it ? :)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id=".profile,-the-global-seting"><code>.profile</code>, the global seting<a class="anchor-link" href="#.profile,-the-global-seting">&#182;</a></h2><p>The <code>.profile</code> file handle all your global configuration. It's here you define your global aliases, your global environment configuration and whatever you think useful.</p>
<p>Here is part of mine (it is way longer) :</p>
<div class="highlight"><pre><span class="c">#!/bin/sh</span>

<span class="c"># Aliases</span>
<span class="c">########################################</span>

<span class="c"># Listings</span>
<span class="nb">alias </span><span class="nv">ls</span><span class="o">=</span><span class="s2">&quot;ls --color=auto&quot;</span>
<span class="nb">alias </span><span class="nv">ll</span><span class="o">=</span><span class="s2">&quot;ls -larth&quot;</span>
<span class="nb">alias </span><span class="nv">sl</span><span class="o">=</span><span class="s2">&quot;ls&quot;</span>   <span class="c"># Mistakes were made :)</span>
<span class="nb">alias </span><span class="nv">la</span><span class="o">=</span><span class="s2">&quot;ls -la&quot;</span>

<span class="c"># Python aliases</span>
<span class="nb">alias </span><span class="nv">notebook</span><span class="o">=</span><span class="s2">&quot;cd ~/NoteBooks &amp;&amp; ipython notebook&quot;</span>

<span class="c"># Environment</span>
<span class="c">########################################</span>

<span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span>fr_FR.UTF-8
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/bin:<span class="nv">$PATH</span>   <span class="c"># Add the bin directory for path finding</span>
<span class="nb">export </span><span class="nv">EDITOR</span><span class="o">=</span>vim             <span class="c"># Set the editor (useful for git)</span>
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span><span class="s2">&quot;xterm-256color&quot;</span>  <span class="c"># Terminal setup for supporting 256 colors</span>

<span class="c"># My scripts setup</span>
<span class="c">########################################</span>

<span class="c"># git-watcher cron &amp; script</span>
<span class="nb">export </span><span class="nv">GIT_WATCHER_CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;$HOME/.config/gitwatcher/datas.txt&quot;</span>
<span class="nb">export </span><span class="nv">GIT_WATCHER_NOTIFY_ICON</span><span class="o">=</span><span class="s2">&quot;$HOME/.config/gitwatcher/icon.png&quot;</span>

<span class="c"># DBUS exportation</span>
<span class="nb">export </span><span class="nv">DBUS_VALUE_FILEPATH</span><span class="o">=</span><span class="s2">&quot;$HOME/.dbus/Xdbus&quot;</span>

<span class="c"># Automations</span>
<span class="c">########################################</span>

<span class="c"># DBUS environment variable exportation</span>
<span class="k">if</span> <span class="o">[</span> ! -s <span class="s2">&quot;$DBUS_SESSION_BUS_ADDRESS&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>env <span class="o">[</span> grep DBUS_SESSION_BUS_ADDRESS | sed <span class="s2">&quot;s/^/export /g&quot;</span> &gt; <span class="nv">$DBUS_VALUE_FILEPATH</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> -f <span class="nv">$DBUS_VALUE_FILEPATH</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">source</span> <span class="nv">$DBUS_VALUE_FILEPATH</span>
<span class="k">fi</span>
</pre></div>
<p>Let's go through this file.</p>
<ul>
<li>Aliases are some shared aliases between my shells. In my mind, it is just some common things I use everytime. You <strong>really</strong> should not make aliases to content modifier commands (like <code>cp</code>, <code>rm</code>, <code>mv</code>...). These are shell dependents, and this is exactly the reason I use two different shells.</li>
<li>After that, I define my environment setings, shared between all my shells. The most important one is <code>$PATH</code>. Defining this command just tell your shell to find commands into a new source directory. The value might look like <code>/usr/local/sbin:/usr/local/bin:/usr/bin</code> (or longer).</li>
<li>My scripts often share some values between them. Instead of defining somewhere else I will forget 2 days after, I define my script setup here.</li>
<li>And to finish, some little automations that will be run every time I open a shell / subshell.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Why-should-I-use-my-shell-rc-?">Why should I use my shell rc ?<a class="anchor-link" href="#Why-should-I-use-my-shell-rc-?">&#182;</a></h2><p>Because it's the configuration of your shell. Not your whole environment configuration. The reason I use 2 shell is pretty easy to understand. I use about 99% of the time <code>zsh</code>, because it's cool, simple and it has a lot of modules. However, I use another shell to do some dangerous operations (like removing or moving large set of data...). Because of this, my prompts are different, my aliases are different, a lot of things are different.</p>
<p>Here is a part of my <code>.zshrc</code> :</p>
<div class="highlight"><pre><span class="c">#!/bin/zsh</span>

<span class="c"># Configuration Option (&#39;cause it&#39;s better with options)</span>
<span class="c">########################################</span>

setopt prompt_subst        <span class="c"># Enable dynamic prompting</span>

<span class="c"># God damn, let&#39;s load some constants</span>
<span class="c">########################################</span>

<span class="nb">source</span> <span class="nv">$HOME</span>/.profile           <span class="c"># Global profile</span>
<span class="nb">source</span> <span class="nv">$HOME</span>/.zsh_aliases       <span class="c"># Source my aliases</span>
<span class="nb">eval</span> <span class="s2">&quot;`dircolors -b $HOME/.ls_colors`&quot;</span> <span class="c"># Colors for ls, tree...</span>

<span class="c"># Okay, now i want zsh do all the things for me.</span>
<span class="c">########################################</span>

autoload colors <span class="o">&amp;&amp;</span> colors  <span class="c"># Guess what ? colors.</span>
setopt correctall          <span class="c"># When you do shit, i&#39;ll correct it</span>

<span class="c"># Completion configuration</span>
zstyle <span class="s1">&#39;:completion:*&#39;</span> list-colors <span class="s2">&quot;${(@s.:.)LS_COLORS}&quot;</span>
autoload -Uz compinit
compinit
zstyle <span class="s1">&#39;:completion:*:descriptions&#39;</span> format <span class="s1">&#39;%U%B%d%b%U&#39;</span>
zstyle <span class="s1">&#39;:completion:*:warnings&#39;</span> format <span class="s1">&#39;%BSorry, no matches for: %d%b&#39;</span>

<span class="c"># Best prompt in da world !</span>
<span class="c">########################################</span>

<span class="c"># This is a git formatter for side informations</span>
<span class="k">function </span>gitformat<span class="o">()</span> <span class="o">{</span>
    <span class="k">if </span>git rev-parse 2&gt; /dev/null; <span class="k">then</span>
<span class="k">        </span><span class="nb">local </span><span class="nv">branch</span><span class="o">=</span><span class="k">${$(</span>git symbolic-ref HEAD 2&gt; /dev/null<span class="k">)</span><span class="p">#refs/heads/</span><span class="k">}</span>
        <span class="nb">local </span><span class="nv">hashcode</span><span class="o">=</span><span class="k">$(</span>git rev-parse --short HEAD 2&gt; /dev/null<span class="k">)</span>
        <span class="nb">local </span><span class="nv">nb_untracked</span><span class="o">=</span><span class="k">$(</span>git status --porcelain | grep <span class="s2">&quot;^??&quot;</span> | wc -l<span class="k">)</span>
        <span class="nb">local </span><span class="nv">nb_modified</span><span class="o">=</span><span class="k">$(</span>git status --porcelain | grep -v <span class="s2">&quot;^??&quot;</span> | wc -l<span class="k">)</span>
        <span class="k">if </span>git diff-index --quiet HEAD --; <span class="k">then</span>
<span class="k">            </span><span class="nb">local </span><span class="nv">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span>
        <span class="k">else</span>
<span class="k">            </span><span class="nb">local </span><span class="nv">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
        <span class="k">fi</span>

<span class="k">        </span><span class="nb">echo</span> -n <span class="s2">&quot;%{$fg_bold[${color}]%}${branch} %{$reset_color%}[%{$fg[${color}]%}${hashcode}%{$reset_color%}] &quot;</span>
        <span class="nb">echo</span> <span class="s2">&quot;%{$fg_bold[${color}]%}${nb_modified}%{$reset_color%}|%{$fg_bold[cyan]%}${nb_untracked}%{$reset_color%} -&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

preexec <span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> -ne <span class="s2">&quot;&quot;</span> <span class="c"># reset scrolling region</span>
<span class="o">}</span>

<span class="k">function </span>_formatuser<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$UID&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> -n <span class="s2">&quot;%{$fg_bold[yellow]%}&quot;</span>
    <span class="k">else</span>
<span class="k">        </span><span class="nb">echo</span> -n <span class="s2">&quot;%{$fg_bold[red]%}&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nb">echo</span> -n <span class="s2">&quot;$USERNAME%{$reset_color%}@%{$fg_bold[cyan]%}$HOST&quot;</span>
<span class="o">}</span>

<span class="k">function </span>_formatevent<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;%{$fg_bold[green]%}%i%{$reset_color%}%{$reset_color%}&quot;</span>
<span class="o">}</span>

<span class="k">function </span>_formatpath<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;%{$fg_bold[white]%}%~%{$reset_color%}&quot;</span>
<span class="o">}</span>

<span class="nv">PROMPT</span><span class="o">=</span><span class="s1">&#39;</span>
<span class="s1">%{$fg_bold[magenta]%}%* %b%{$fg[magenta]%}(%D)%{$reset_color%} $(gitformat) </span>
<span class="s1">┌─[$(_formatuser) $(_formatevent)] $(_formatpath)</span>
<span class="s1">└─ %# &#39;</span>
</pre></div>
<p>And this is <strong>a part</strong> of it. This is my common shell. I use it whenever I want, whenever I need etc. However, when I'm manipulating data that might be dangerous (like removing stuff etc), I prefere using <code>bash</code>. My bashrc is really clean :</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Source the profile</span>
<span class="nb">source</span> <span class="nv">$HOME</span>/.profile

<span class="c"># Just a better prompt</span>
<span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u\[\033[00m\]@\[\033[01;31m\]funkysayu\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\n-&gt;\$ &#39;</span>

<span class="c"># Default color for ls and tree</span>
<span class="nb">export </span><span class="nv">LS_OPTIONS</span><span class="o">=</span><span class="s1">&#39;--color=auto&#39;</span>
<span class="nb">eval</span> <span class="s2">&quot;`dircolors`&quot;</span>

<span class="c"># Some more alias to avoid making mistakes:</span>
<span class="nb">alias </span><span class="nv">rm</span><span class="o">=</span><span class="s1">&#39;rm -i&#39;</span>
<span class="nb">alias </span><span class="nv">cp</span><span class="o">=</span><span class="s1">&#39;cp -i&#39;</span>
<span class="nb">alias </span><span class="nv">mv</span><span class="o">=</span><span class="s1">&#39;mv -i&#39;</span>
</pre></div>
<p>Simple, clean, don't need more.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Put-your-scripts-in-your-bin/-directory">Put your scripts in your <code>bin/</code> directory<a class="anchor-link" href="#Put-your-scripts-in-your-bin/-directory">&#182;</a></h2><p>As said before, we extended the variable <code>$PATH</code> in the <code>.profile</code>. That means that every shell have this variable extended, and you can now put your scripts into it and call them with a simple command.</p>
<p>Let's take for example the following scripts :</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s2">&quot;Hey, I&#39;m a tomato !&quot;</span>
</pre></div>
<p>If you put this script into the file located to <code>$HOME/bin/tomato</code> and setup the execution right on it (<code>chmod +x $HOME/bin/tomato</code>), you can then execute this as a command :</p>

<pre><code>$ tomato
Hey, I'm a tomato !</code></pre>
<p><strong>Note</strong>: your completion may not find the new <code>tomato</code> command, because your shell may not update everytime your commands list. To update your completion database, you can restart your shell.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Example-:-git-watcher">Example : <code>git-watcher</code><a class="anchor-link" href="#Example-:-git-watcher">&#182;</a></h1><p>At this point, you may think that it's using the bazooka to shoot the ant. Let's take a cool example : using <code>notify-send</code> into a <code>cron</code>. It's the kind of thing I love doing. For example, everytime I have a new mail, I receive a notification from one of my script on my desktop. This is a really cool stuff.</p>
<p>We will take as example my <code>git-watcher</code> module. This module checks every 5 minutes if a new push has been done on a git I'm "watching".</p>
<p>I use two scripts :</p>
<ul>
<li>the <code>watch-git</code> script to add a repository to watch</li>
<li>the <code>git-watcher</code> script that will send notifications through a cron.</li>
</ul>
<p>These two scripts use shared environment variables :</p>
<ul>
<li><code>GIT_WATCHER_CONFIG_FILE</code> containing all the repositorys to watch,</li>
<li><code>GIT_WATCHER_NOTIFY_ICON</code> which is the icon used for notifications,</li>
<li><code>DBUS_SESSION_BUS_ADDRESS</code> indicating which interface to send notifications on (required by <code>notify-send</code>).</li>
</ul>
<h2 id="Define-the-bash-script-watch-git-to-add-a-repository-in-the-watch-list">Define the bash script <code>watch-git</code> to add a repository in the watch list<a class="anchor-link" href="#Define-the-bash-script-watch-git-to-add-a-repository-in-the-watch-list">&#182;</a></h2><p>First off, I created a bash script into my <code>bin/</code> directory named <code>watch-git</code>. This script is pretty simple :</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Just checking if user knows how the script works</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$# </span>-ne 2 <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Usage : $0 {repository} {branch}&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Add to the git-watcher cron a repository to watch.&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Checking if environment variables are set</span>
<span class="k">if</span> <span class="o">[</span> -z <span class="nv">$GIT_WATCHER_CONFIG_FILE</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Error: GIT_WATCHER_CONFIG_FILE environment variable not set.&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Set it to know where I should put my datas !&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Creating file if not exists</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;$GIT_WATCHER_CONFIG_FILE&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Git watcher config file not found. Creating a new one.&quot;</span>
    <span class="k">if</span> <span class="o">[</span> ! -d <span class="sb">`</span>dirname <span class="nv">$GIT_WATCHER_CONFIG_FILE</span><span class="sb">`</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir -p <span class="sb">`</span>dirname <span class="nv">$GIT_WATCHER_CONFIG_FILE</span><span class="sb">`</span>
    <span class="k">fi</span>
<span class="k">    </span>touch <span class="s2">&quot;$GIT_WATCHER_CONFIG_FILE&quot;</span>
<span class="k">fi</span>

<span class="nv">repository</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>
<span class="nv">branch</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>

<span class="c"># Check if not already watching...</span>
grep <span class="s2">&quot;$repository $branch&quot;</span> <span class="s2">&quot;$GIT_WATCHER_CONFIG_FILE&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">echo</span> <span class="s2">&quot;You are already watching this repository.&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">exit </span>1

<span class="nv">hashcode</span><span class="o">=</span><span class="s2">&quot;0000000000000000000000000000000000000000&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;$hashcode\t$repository\t$branch&quot;</span> &gt;&gt; <span class="nv">$GIT_WATCHER_CONFIG_FILE</span>
</pre></div>
<p>With this, you have now a new command <code>watch-git</code> allowing you to add a repository to watch.</p>
<h2 id="Define-the-cron-bash-script-git-watcher-to-send-you-notifications-every-5-minutes">Define the cron bash script <code>git-watcher</code> to send you notifications every 5 minutes<a class="anchor-link" href="#Define-the-cron-bash-script-git-watcher-to-send-you-notifications-every-5-minutes">&#182;</a></h2><p>Let's take a look to the cron script. He is a bit long, but the sense is pretty simple to get.</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Load environment variables if they exists. Else exit 1</span>
<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;$HOME/.profile&quot;</span> <span class="o">]</span>; <span class="k">then</span>
    . <span class="s2">&quot;$HOME/.profile&quot;</span>
<span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Profile not found. Exiting.&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Creating git watcher config file if it doesn&#39;t exists</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$GIT_WATCHER_CONFIG_FILE</span> <span class="o">]</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Git watcher config file not found. Creating an empty one.&quot;</span>
    <span class="k">if</span> <span class="o">[</span> ! -d <span class="k">$(</span>dirname <span class="nv">$GIT_WATCHER_CONFIG_FILE</span><span class="k">)</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir -p <span class="k">$(</span>dirname <span class="nv">$GIT_WATCHER_CONFIG_FILE</span><span class="k">)</span>
    <span class="k">fi</span>
<span class="k">    </span>touch <span class="nv">$GIT_WATCHER_CONFIG_FILE</span>
<span class="k">fi</span>

<span class="c"># Creating temp dir to fetch git watched and git results</span>
<span class="nv">new_config</span><span class="o">=</span><span class="sb">`</span>mktemp<span class="sb">`</span>

<span class="c"># Actually do the shit</span>
<span class="k">while </span><span class="nb">read </span>line
<span class="k">do</span>
    <span class="c"># Parsing basic fields</span>
    <span class="nv">offlinehash</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$line</span> | cut -d <span class="s2">&quot; &quot;</span> -f 1<span class="sb">`</span>
    <span class="nv">repository</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$line</span> | cut -d <span class="s2">&quot; &quot;</span> -f 2<span class="sb">`</span>
    <span class="nv">branch</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$line</span> | cut -d <span class="s2">&quot; &quot;</span> -f 3<span class="sb">`</span>

    <span class="c"># Parsing more specific fields</span>
    <span class="nv">server</span><span class="o">=</span><span class="k">${</span><span class="nv">repository</span><span class="p">#*:</span><span class="k">}</span>
    <span class="nv">reponame</span><span class="o">=</span><span class="k">${</span><span class="nv">repository</span><span class="p">%:*</span><span class="k">}</span>

    <span class="c"># Getting hashes</span>
    <span class="nv">onlinehash</span><span class="o">=</span><span class="sb">`</span>git ls-remote <span class="nv">$repository</span> <span class="nv">$branch</span><span class="sb">`</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$?&quot;</span> -ne <span class="s2">&quot;0&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> <span class="s2">&quot;Failure : unable to retrieve informations.&quot;</span>
        rm <span class="s2">&quot;$new_config&quot;</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">onlinehash</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$onlinehash</span> | cut -d <span class="s1">&#39; &#39;</span> -f 1<span class="sb">`</span>

    <span class="c"># Send notifications if there&#39;s a new push</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$offlinehash&quot;</span> !<span class="o">=</span> <span class="s2">&quot;$onlinehash&quot;</span> <span class="o">]</span> ; <span class="k">then</span>
<span class="k">        </span>notify-send <span class="s2">&quot;GitWatcher : new push detected&quot;</span> <span class="se">\</span>
            <span class="s2">&quot;Repository: $reponame\nServer: $server&quot;</span> <span class="se">\</span>
            -i <span class="s2">&quot;$GIT_WATCHER_NOTIFY_ICON&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nb">echo</span> -e <span class="s2">&quot;$onlinehash\t$repository\t$branch&quot;</span> &gt;&gt; <span class="s2">&quot;$new_config&quot;</span>
<span class="k">done</span> &lt; <span class="s2">&quot;$GIT_WATCHER_CONFIG_FILE&quot;</span>

<span class="c"># Move the new configuration</span>
mv <span class="s2">&quot;$new_config&quot;</span> <span class="s2">&quot;$GIT_WATCHER_CONFIG_FILE&quot;</span>
</pre></div>
<h2 id="Setup-your-environment">Setup your environment<a class="anchor-link" href="#Setup-your-environment">&#182;</a></h2><p>As said before, you need 3 variables (<code>GIT_WATCHER_CONFIG_FILE</code>, <code>GIT_WATCHER_NOTIFY_ICON</code> and <code>DBUS_SESSION_BUS_ADDRESS</code>). These are <em>shared</em> variables, because they can be used in any shells. So we define this variables into the <code>.profile</code> file :</p>
<div class="highlight"><pre><span class="c"># .../...</span>

<span class="c"># My scripts setup</span>
<span class="c">########################################</span>

<span class="c"># .../...</span>

<span class="c"># git-watcher cron &amp; script</span>
<span class="nb">export </span><span class="nv">GIT_WATCHER_CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;$HOME/.config/gitwatcher/datas.txt&quot;</span>
<span class="nb">export </span><span class="nv">GIT_WATCHER_NOTIFY_ICON</span><span class="o">=</span><span class="s2">&quot;$HOME/.config/gitwatcher/icon.png&quot;</span>

<span class="c"># DBUS exportation</span>
<span class="nb">export </span><span class="nv">DBUS_VALUE_FILEPATH</span><span class="o">=</span><span class="s2">&quot;$HOME/.dbus/Xdbus&quot;</span>

<span class="c"># Automations</span>
<span class="c">########################################</span>

<span class="c"># DBUS environment variable exportation</span>
<span class="k">if</span> <span class="o">[</span> ! -s <span class="s2">&quot;$DBUS_SESSION_BUS_ADDRESS&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>env <span class="o">[</span> grep DBUS_SESSION_BUS_ADDRESS | sed <span class="s2">&quot;s/^/export /g&quot;</span> &gt; <span class="nv">$DBUS_VALUE_FILEPATH</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> -f <span class="nv">$DBUS_VALUE_FILEPATH</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">source</span> <span class="nv">$DBUS_VALUE_FILEPATH</span>
<span class="k">fi</span>

<span class="c"># .../...</span>
</pre></div>
<h2 id="Add-your-cron-to-your-crontab">Add your cron to your crontab<a class="anchor-link" href="#Add-your-cron-to-your-crontab">&#182;</a></h2><p>The last step is to add your <code>git-watcher</code> into your crontab. Actually doing this is pretty simple. Just run a <code>crontab -e</code> and add the following line :</p>

<pre><code>*/5 * * * * $HOME/bin/cron/git-watcher</code></pre>
<p>If you did not understand the above line, you should take a look to <a href="http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">this really well explained tuto about crontab</a>.</p>
<h1 id="You're-done-!">You're done !<a class="anchor-link" href="#You're-done-!">&#182;</a></h1><p>Any questions ? Any mistakes ? Tell me !</p>

</div>
</div>
</div>